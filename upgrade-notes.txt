!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
`Citation Style Language 1.0`__
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
?????????????
Upgrade Notes
?????????????

__ `Table of Contents`_

.. class:: info-version

   version x.x

.. class:: info-date

   December 6, 2009

.. class:: contributors

   Authors
       * Frank Bennett
       * Bruce D'Arcus
       * Rintze Zelle

.. |link| image:: link.png


========

.. contents:: Table of Contents

========

Citation Style Language 1.0 - What's New?
=========================================

`Citation Style Language 1.0 <http://citationstyles.org/citation-style-language/schema-and-specification/#CSL1.0>`_ represents a significant update of the Citation Style Language (CSL), an open XML-based standard to describe citation styles. This document describes the changes that have been made since the previous release (`CSL 0.8 <http://citationstyles.org/citation-style-language/schema-and-specification/#CSL0.8>`_, released in March 2009), and thus is primarily aimed at those with prior CSL experience.

**Nota Bene** These notes include many XML examples to demonstrate new CSL features. Please note that these examples are reduced to a minimum, and often don't constitute valid CSL styles. In addition, when references are made to the XML elements of CSL, the CSL namespace ("cs") is always attached as a prefix (e.g. ``cs:citation`` for the ``citation`` element). However, for CSL styles it is customary to declare the default CSL namespace in the root ``cs:style`` element (<style xmlns="http://purl.org/net/xbiblio/csl" />), which eliminates the need to include this namespace for each element.

Project Home(s)
+++++++++++++++

The first change is that the CSL project has been moved to a new home at `CitationStyles.org <http://citationstyles.org/>`_ (the old project home was located at `<http://xbiblio.sourceforge.net/csl/>`_). This website will be the central location to find CSL schemas, CSL documentation and CSL styles.

For development the `SourceForge CSL mailing list <http://sourceforge.net/mailarchive/forum.php?forum_name=xbiblio-devel>`_ will be kept in use, but a switch has been made from SourceForge.net to `Bitbucket.org <http://bitbucket.org/>`_ for hosting the project code. The current code repositories are:

 * `<http://bitbucket.org/bdarcus/csl-schema/>`_ - CSL schema
 * `<http://bitbucket.org/bdarcus/csl-locales/>`_ - CSL locale files
 * `<http://bitbucket.org/bdarcus/csl-docs/>`_ - CSL documentation
 * `<http://bitbucket.org/bdarcus/csl-utils/>`_ - CSL utilities (mostly scripts)

Documentation
+++++++++++++

Prior to the release of CSL 1.0, CSL documentation was rather scarce. Most of what was available was hosted on the `Zotero wiki <http://www.zotero.org/support/dev/csl_syntax_summary>`_. With CSL 1.0, we hope to improve on this situation. In addition to these upgrade notes, a full specification_ has been made available. As before, the `schema <http://citationstyles.org/citation-style-language/schema-and-specification/#CSL1.0>`_ itself is also a source of information, although reading the schema requires some understanding of `RELAX NG Compact <http://www.relaxng.org/>`_, the XML schema language in which the CSL schema is written.

.. _specification: http://citationstyles.org/citation-style-language/schema-and-specification/#CSL1.0

Schema
++++++

Split Schema
------------

The schema of `CSL 0.8 <http://citationstyles.org/citation-style-language/schema-and-specification/#CSL0.8>`_ consists of a single file. With CSL 1.0, the schema has been split into multiple files:

 * csl.rnc - The core of the CSL schema. This file contains most of the schema logic and calls the other schema files
 * csl-categories.rnc
 * csl-terms.rnc
 * csl-types.rnc
 * csl-variables.rnc

The main advantage of splitting up the schema is that the schema will be easier to maintain. If you wish to validate styles against the CSL schema, make sure all the files are located in the same directory, and validate against csl.rnc.

csl-data
~~~~~~~~

Although hosted in the same code repository as the rest of the schema, csl-data.rnc is not used for style validation. Instead, it describes how data can (and should) be presented to CSL processors, such as citeproc-js_. Note that the structured input data doesn't need to consist of XML (e.g. citeproc-js_ accepts JSON).

.. _citeproc-js: http://bitbucket.org/fbennett/citeproc-js/

Validation
----------

The CSL 1.0 schema has been extended with two Schematron rules to make sure styles don't use ``cs:text`` and ``cs:key`` elements that call non-existing ``cs:macro`` elements. Note that not all validators support embedded Schematron code (e.g. `Jing <http://www.thaiopensource.com/relaxng/jing.html>`_ just ignores the rules). In addition, the CSL 1.0 schema can now be used to validate the `locales files`_ (e.g. "locales-en-US.xml"), which contain localizations of terms, date formats and style options.

.. _locales files: http://bitbucket.org/bdarcus/csl-locales/src/

Styles
++++++

Updating CSL 0.8 Styles
-----------------------

CSL 1.0 is backward incompatible with CSL 0.8, which means that 'old' styles written for CSL 0.8 won't work with CSL 1.0 processors. Fortunately, it is possible to (automatically) update CSL 0.8 styles to the CSL 1.0 format using the `upgrade.xsl <http://bitbucket.org/bdarcus/csl-utils/src/tip/update.xsl>`_ XSLT stylesheet. The developers of Zotero will perform this conversion for all the styles in the `Zotero Style Repository <http://www.zotero.org/styles>`_. However, if you use (custom) CSL styles that aren't included in this style repository, you might need to do this yourself.

Using upgrade.xsl
~~~~~~~~~~~~~~~~~

First, check whether the styles that you wish to update validate against the `CSL 0.8 schema <http://citationstyles.org/citation-style-language/schema-and-specification/#CSL0.8>`_.

Then use an XSLT processor to update the styles. Available options are the command-line tools `Saxon <http://saxon.sourceforge.net/>`_ and `xsltproc <http://xmlsoft.org/XSLT/xsltproc2.html>`_. Alternatively, one of the (more user-friendly) online converters, such as the one offered by `www.shell-tools.net <http://www.shell-tools.net/index.php?op=xslt>`_ can be used. For the latter tool, the instructions are:

1. Paste the contents of `upgrade.xsl <http://bitbucket.org/bdarcus/csl-utils/src/tip/update.xsl>`_  into the "xslt" text box at `<http://www.shell-tools.net/index.php?op=xslt>`_
2. Paste the contents of the CSL 0.8 style into the "xml" text box
3. Click the "Submit Query"-button
4. Copy the text from the "output" text box to a suitable text editor (e.g.
   Notepad on Windows) and save the file with a .csl-extension.

Finally, after the conversion, it is recommended to validate the converted style, this time against the `CSL 1.0 schema`_.

.. _CSL 1.0 schema: http://citationstyles.org/citation-style-language/schema-and-specification/#CSL1.0

Version Number
--------------

Starting with CSL 1.0, a style must indicate for which CSL version the style was written. All CSL 1.0 styles should carry the value "1.0" on the ``version``-attribute on the cs:style element, e.g.:

.. sourcecode:: xml

    <style version="1.0" class="in-text"/>

Options as Attributes
---------------------

In CSL 0.8, citation- and bibliography-specific style options were set with ``cs:option`` elements. In CSL 1.0 this element is no longer used. Instead, options are set using attributes. CSL 1.0 includes global options, which affect the output of both the ``citation`` and ``bibliography`` sections, and which are set as attributes on the ``cs:style`` element. Options that are citation-specific are now set on the ``cs:citation`` element, while bibliography-specific options are set on the ``cs:bibliography`` element.

ISSN and ISSN-L
---------------

ISSN-identifiers unambiguously identify journals. While CSL 0.8 allowed only a single ISSN identifier to be included in the style metadata section, CSL 1.0 now supports multiple ISSNs (e.g. the ISSNs of the print and online editions of a journal), as well as the relatively new `ISSN-L <http://www.issn.org/2-22637-What-is-an-ISSN-L.php>`_ identifier. For example:

.. sourcecode:: xml

    <style>
      <info>
        <issn>1234-1234</issn>
        <issn>4567-4567</issn>
        <issnl>8521-8521</issnl>
      </info>
    </style>

Localization
------------

The "locales-xx-XX.xml" files (with "xx-XX" indicating the locale, e.g. "en-US" for "English - United States") that are part of CSL previously had only the role of supplying localized terms (translations are made via `BabelZilla <http://www.babelzilla.org/>`_). With CSL 1.0, these locale files also contain localized style options and localized date formats. Because of this, some changes have been made to the XML format of these files: ``cs:locale`` has replaced ``terms`` as the root element, both the ``xml:lang`` and ``xmlns`` attributes are applied to the ``cs:locales`` element, and new elements have been introduced to localize dates and options (``cs:date``, ``cs:date-part`` and ``cs:style-options``). As before, any content of the "locales-xx-XX.xml" files can be overridden in a CSL style (using the ``xml:lang`` attribute on ``cs:locale`` to select the correct locale to override), e.g.:

.. sourcecode:: xml

    <style>
      <locale xml:lang="en">
        <style-options punctuation-in-quote="true" />
        <terms>
          <term name="et-al">et alii</term>
        </terms>
        <date form="text">
          <date-part name="month" suffix=" " form="short"/>
          <date-part name="day" suffix=", "/>
          <date-part name="year"/>
        </date>
      </locale>
    </style>

Localized Dates
~~~~~~~~~~~~~~~

CSL 1.0 introduces support for date localization. This feature is optional: styles can still define dates in the usual non-localized format. To use a localized date, all you need to do is use ``cs:date`` with the ``form`` attribute set to either ``text`` (for dates like 'April 21, 2008') or ``numeric`` (e.g. '4/21/08'). As demonstrated in the example below, it is not necessary
to specify any ``cs:date-part`` elements for localized dates:

.. sourcecode:: xml

    <style>
      <bibliography>
        <layout>
          <!-- old-fashioned, unlocalized date -->
          <date variable="accessed">
            <date-part name="year"/>
            <date-part name="month" form="numeric" prefix="-"/>
            <date-part name="day" prefix="-"/>
          </date>
          <!-- default localized date -->
          <date form="numeric"/>
        </layout>
      </bibliography>
    </style>

The format of localized dates (i.e. punctuation and the order of the date-parts) is specified in the "locales-xx-XX.xml". As with terms, localized date formats can be overridden within styles. In addition, localized dates can be customized within a style via two options. First, the ``date-parts`` attribute can be added to ``cs:date`` to control which date-parts are shown. With the default value of ``year-month-day`` the whole date is shown. With ``year-month`` and ``year`` only the year/month and year date-parts are shown, respectively. The second option is the ability to redefine how one or more ``cs:date-part`` element are formatted. Note that the order of ``cs:date-part`` elements for a localized date within ``cs:layout`` doesn't affect the rendering order of the date-parts (this in contrast with non-localized dates or dates specified within ``cs:locale``, where the order of the ``cs:date-part`` elements does control the rendering order). Neither does the presence or absence of ``cs:date-part`` elements affect which date-parts are shown (this is controlled via the ``date-parts`` attribute described above). Instead, ``cs:date-part`` elements allow you to override specific properties of the localized date-parts (e.g. the `form` of the month-date-part can be set to "short"). Note that changes made in this way affect all locales. An example illustrating the different options:

.. sourcecode:: xml

    <style>
      <!-- a modified date format for the English locale -->
      <locale xml:lang="en">
        <date form="text">
          <date-part name="month" suffix=" " form="short"/>
          <date-part name="day" suffix=", "/>
          <date-part name="year"/>
        </date>
      </locale>
      <bibliography>
        <layout>
          <!-- localized date that only shows the year and month -->
          <date form="text" date-parts="year-month"/>
          <!-- localized date in numeric format with leading zeros and affixes for month and day -->
          <date form="numeric">
            <date-part name="month" form="numeric-leading-zeros" prefix="/"/>
            <date-part name="day" form="numeric-leading-zeros" prefix="/"/>
          </date>
        </layout>
      </bibliography>
    </style>

Note that it is not allowed to apply affixes (prefixes and suffixes) to ``cs:date`` when used within ``cs:locale`` (either in styles or in the "locales-xx-XX.xml" files). Instead, all punctuation should be applied to the ``cs:date-part`` elements. This separates locale-independent affixes (e.g. parentheses around the date, as in "(2000)") from locale-dependent punctuation, a requirement for robust date localization.

Localized Options
~~~~~~~~~~~~~~~~~

In addition to localized dates and terms, CSL 1.0 now also supports localized options (although for now, there is only one such an option, ``punctuation-in-quote``). The default value of localized
options is set for each locale in the "locales-xx-XX.xml" files, but these values can be overridden using the ``cs:style-options`` element within ``cs:locale`` in a CSL style. An example:

.. sourcecode:: xml

    <style>
      <locale xml:lang="en">
        <style-options punctuation-in-quote="true"/>
      </locale>
    </style>

Default Locale
~~~~~~~~~~~~~~

To prevent localization of styles (which might be desirable for journal-specific styles) the ``default-locale`` attribute can be included on the ``cs:style`` element (this attribute already existed in CSL 0.8, but was not supported by Zotero). The possible values of this attribute are the locale codes (e.g. "fr-FR" for French). A full list of locale codes can be found in `Zotero's chrome manifest <https://www.zotero.org/svn/extension/trunk/chrome.manifest>`_. An example:

.. sourcecode:: xml

    <style default-locale="fr-FR"/>

N.B. With CSL 0.8 there was some confusion about the use of ``default-locale``, and some style authors included the ``xml:lang`` attribute instead. In CSL 1.0 ``xml:lang`` is no longer allowed as an attribute on ``cs:style``.

Formatting
----------

Quotes
~~~~~~

CSL 1.0 introduces new terms for inner ("open-inner-quote" and "close-inner-quote", e.g. ‘ and ’) and outer quotes ("open-quote" and "close-quote", e.g. “ and ”). Together with the new ``punctuation-in-quote``-option (see `Punctuation around Quotes`_), quotes can now be fully localized (as long as they are specified via the ``quotes`` attribute). In addition, quotes can now be properly nested (using alternating quotation marks), e.g.:

 * title: My “Nested” Title
 * title with quotes: “My ‘Nested’ Title”

Punctuation around Quotes
^^^^^^^^^^^^^^^^^^^^^^^^^

The localized option ``punctuation-in-quote`` is used to specify whether punctuation (commas and periods) should appear within ("true", e.g. for American English) or outside quotation marks that have been applied by the style ("false" (default value), e.g. for British English). As such, it can toggle the style output between

    Douglas Adams, "The Hitchhiker's Guide to the Galaxy," 1979.

and

    Douglas Adams, "The Hitchhiker's Guide to the Galaxy", 1979.

Pages
~~~~~

CSL 1.0 introduces two new page variables: "page-first" and "number-of-pages". The existing variable "pages" is still used for page ranges (e.g. of journal articles and book chapters). The variable "page-first" holds the first page of the page range. The variable "number-of-pages" is used to indicate the total number of pages of an item (e.g. a book or thesis).

In addition, a new global (non-localized) option, ``page-range-format``, has been added to control the collapsing of page ranges. This attribute, set on ``cs:style``, can have the values "expanded" (e.g. "321-328"), "minimal" ("321-8"), and "chicago" ("321-28", which follows the collapsing rules of the Chicago Manual of Style). When the attribute isn't present, the content of the "page"-variable is shown as is. An example:

.. sourcecode:: xml

    <style page-range-format="chicago">
      <bibliography>
        <layout>
          <text variable="page"/>
        </layout>
      </bibliography>
    </style>

Rich Text Markup within Fields
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Although not part of CSL 1.0, the new citeproc-js_ CSL processor used by Zotero supports a new feature that deserves some notice: the ability to use rich text markup within fields.

Rich text markup can be applied with a small set of HTML(-like) tags:

-  ``<b>`` - bold
-  ``<i>`` - italics
-  ``<sc>`` - small-caps
-  ``<sub>`` - subscript
-  ``<sup>`` - superscript

E.g. if a Zotero item has the title "Ca<sup>2+</sup> levels in <i>Homo sapiens</i>", this will automatically be converted to "Ca\ :sup:`2+`\  levels in *Homo sapiens*" when a citation is rendered.

Citation Collapsing
~~~~~~~~~~~~~~~~~~~

CSL 1.0 offers finer control of citation collapsing. First, two new options have been introduced, both of which are set as attributes on ``cs:citation``: ``year-suffix-delimiter``, which defines the delimiter for subsequent year suffixes (e.g. the comma in "Doe 2000a,b, Smith 1999"), and ``after-collapse-delimiter``, which defines the delimiter between a group of collapsed citations and the subsequent citation (e.g. the semicolon in "Doe 2000a, b; Smith 1999, Williams 2002"). Both attributes default to the delimiter set on the ``cs:layout`` element within ``cs:citation``. Secondly, "year-suffix-ranged" has been added as a possible value of the ``collapse`` attribute of ``cs:citation``. If ``collapse`` is set this value, citations are collapsed as with "year-suffix", but ranges of year-suffixes are collapsed as well (e.g. "Doe 2000a,b,c,e" would become "Doe 2000a-c,e"). An example of how these attributes are set:

.. sourcecode:: xml

    <style>
      <citation collapse="year-suffix-ranged" year-suffix-delimiter="," after-collapse-delimiter=";">
        <layout delimiter=", " />
      </citation>
    </style>

Year Suffix
~~~~~~~~~~~

Year-suffixes are included automatically when the ``disambiguate-add-year-suffix`` attribute on ``cs:citation`` is set to "true". However, some styles desire special markup of year-suffixes, such as italics (e.g. "``2000``\ *a*, *b*"). For this CSL 1.0 introduces the ``year-suffix`` variable, which can be used to explicitly specify the location and formatting of year-suffixes. An example:

.. sourcecode:: xml

    <style>
      <citation>
        <layout delimiter=", ">
          <date variable="issued">
            <date-part name="year"/>
          </date>
          <text variable="year-suffix" font-style="italic"/>
        </layout>
      </citation>
    </style>

Names
~~~~~

delimiter-precedes-last
^^^^^^^^^^^^^^^^^^^^^^^

The ``delimiter-precedes-last`` attribute on ``cs:names`` controls the use of the name delimiter between the last and next-to-last name in name lists. In CSL 0.8, this attribute could be set to either ``always`` or ``never``. To include the delimiter for lists of three or more names ("Doe, Smith, and Williams") and to exclude it for lists of only two names ("Doe and Smith"), you would have to leave out the attribute. Now, in CSL 1.0, it is also possible to explicitly set the last behavior by using the value "contextual".

Formatting Name Parts
^^^^^^^^^^^^^^^^^^^^^

CSL 1.0 introduces the ability to separately format given and family names. Formatting is specified via the new ``cs:name-part`` element, a child of ``cs:name``. The ``name`` attribute of this element should be set to either "family" or "given". Note that the order of ``name-part`` elements does not affect the order in which the name parts are shown. An example, resulting in names like "John SMITH":

.. sourcecode:: xml

    <names variable="author">
      <name form="long">
        <name-part name="family" font-variant="capitalize-all"/>
      </name>
    </names>

Et al.
^^^^^^

A new element, ``cs:et-al``, can now be included within ``cs:names``. This adds two important features. First, formatting can now be set independently for the ``et-al`` term. For example,

.. sourcecode:: xml

    <names variable="author">
      <name/>
      <et-al font-style="italics" prefix=" "/>
    </names>

results in "Doe *et al.*". Secondly, it is now possible to use two different ``et-al`` terms within a single style (e.g. one for in-text citations and one for the bibliography). The desired term, "et-al" (the default) or "and others", is set with the ``name`` attribute on the ``cs:et-al`` element. For example,

.. sourcecode:: xml

    <names variable="author">
      <name/>
      <et-al term="and others" prefix=" "/>
    </names>

would yield "Doe and others" (note that both terms are localized).

Stripping Periods
~~~~~~~~~~~~~~~~~

A new attribute, ``strip-periods``, can now be set on ``cs:date-part`` (only for name="month"), ``cs:label`` and ``cs:text``. The attribute is inactive when set to "false" (the default value), but if set to "true", any periods are stripped from the variable contents.

``strip-periods`` is especially useful for journal abbreviations. There are plans to further improve support for journal abbreviations in future versions of CSL (e.g. by using lookup lists to find the correct journal abbreviation given a certain journal title), but for now it is recommended that users include periods for journal abbreviations in their (Zotero) libraries. With the help of ``strip-periods``, styles can then either use the journal abbrevation as is, or use a version without periods. An example:

.. sourcecode:: xml

    <text variable="container-title" form="short" strip-periods="true"/>

would output "Appl Environ Microbiol" if the journal abbreviation for the Zotero item is "Appl. Environ. Microbiol.".

Pluralization
~~~~~~~~~~~~~

Pluralization has been a bit of an odd duck, as the implementation
in Zotero differed somewhat from the official CSL schema. In CSL
1.0 and the new Zotero citeproc-js CSL processor, pluralization
options have been aligned: the attribute ``plural`` is now
available for ``cs:text`` and ``cs:label``. For ``cs:text`` the
value of ``plural`` can be either ``false`` (default), to use the
singular variant of a term, or ``true``, to use the plural variant.
For ``cs:label`` the default value is ``contextual`` (default, e.g.
"p. 43" and "pp. 3-5"). With the values ``never`` and ``always`` it
is possible to force ``cs:label`` to always use respectively the
singular form or the plural form of the specified term. An
example:

.. sourcecode:: xml

    <number variable="edition" form="ordinal"/>
    <text term="edition" plural="true"/>
    <group>
      <label variable="page" plural="always"/>
      <text variable="page"/>
    </group>

Layout Control with the Display Attribute
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


-  Display attributes for positioning blocks comprising a cite.

Disambiguation
--------------

Disambiguation is the automated transformation of in-text
references and corresponding bibliography entries, such that the
former uniquely identify the latter. Although an indispensable
feature of CSL, this feature has been a source of occasional
confusion among users, for three independent reasons: (1) unwanted
transformations can be triggered by small differences in the form
of an author's name in Zotero database entries; (2) there were
sometimes subtle discrepancies between the Zotero disambiguation
algorithms and the rules required by a given style; and (3) little
documentation has been available on what disambiguation actually
*does*.

Building on user feedback and experience with the first deployment
of disambiguation support, CSL 1.0 is now able to offer a rich set
of disambiguation algorithms. The options described below should
allow you to precisely address the requirements of a target style.
Once your style is known to apply the correct rules for
disambiguation, Zotero forum support can focus on the need for
proper curation of author names, and some of the fog should begin
to lift over this corner of bibliography management.

Disambiguation Concepts
~~~~~~~~~~~~~~~~~~~~~~~

For clarity, the discussion below will draw upon several special
concepts and distinctions.

Cites versus Names
    Previous documentation did not distinguish between the
    disambiguation of cites themselves, and the disambiguation of
    creator names. In the discussion below, the former will be referred
    to as "cite-based disambiguation", and the latter as "names-based
    disambiguation". In cite-based disambiguation, changes are limited
    to the actual cites that must be distinguished. In names-based
    disambiguation, changes to the form of a name are global, and may
    affect cites that were unique to begin with.

Name transformation level
    As in previous versions of CSL, a name may be cast at three
    transformation levels: ``short`` form, which is the family name
    alone ("short form"); ``long`` form with given name initialized
    ("initialized form"); or the full name ("long form"). Depending on
    the attributes set on the ``names`` node, and the disambiguation
    attributes set on the ``citation`` node, one or more of the three
    levels may be unavailable. The available form closest to the first
    of the three forms at any point in processing is "the lowest
    available transformation level", and that nearest to the last is
    "the highest available transformation level".

Cite Pools
    When performing cite-based disambiguation, the cites to be
    compared, transformed and distinguished are those which have the
    same base ``citation`` form when the ``position="subsequent"``
    condition is true. Such a group of cites will be referred to below
    as a "cite pool". Members of a cite pool are compared with one
    another under a progressive series of transformations. A cite exits
    the pool when it can be distinguished from the others.

Unique Creator Names
    In names-based disambiguation, the full form of the name is assumed
    to uniquely identify a creator (author, editor, etc.) within the
    document. This full form of the name is the "unique creator name".

Name Pools
    In names-based disambiguation, if a name form at a given
    transformation level applies to more than one unique creator, the
    unique creator names associated with it form a "name pool".


Processing Flow
~~~~~~~~~~~~~~~

Processing begins with the identification of cite pools for
cite-based disambiguation. If the ``disambiguate-add-names``
attribute is set to ``true``, the first stage of processing in each
cite pool adds names to each cite incrementally, using the lowest
available transformation level for each name added.

When names are added to a cite during the add-names phase, the act
of adding the name may give rise to a *name pool* for purposes of
names-based disambiguation. Accordingly, if required by the style
options, names-based disambiguation is performed on the name before
it is added to the cites in a cite pool during cite-based
disambiguation.

Names-based disambiguation will be performed in this way if and
only if the ``disambiguate-add-givenname`` attribute is set to
``true`` *and* the ``givenname-disambiguation-rule`` attribute is
set to one of the following values, or is absent (and hence carries
the default value of ``all-names``):


-  ``all-names``
-  ``all-names-with-initials``
-  ``primary-name``
-  ``primary-name-with-initials``

As described below, the latter two rules in this list will touch
only names that appear in the first position in a list of creator
names; with these two rules, all other names will always use the
lowest transformation level available in the ``names`` node
concerned, without regard to disambiguation considerations.

If the ``disambiguate-add-givenname`` attribute is set to ``true``
and the value of ``givenname-disambiguation-rule`` is set to
``by-cite``, name pools will be ignored, and no names-based
disambiguation will be performed. This may result in lingering
ambiguity between cites. For example, consider the following
bibliographic information:


=========  ==================================  ======  ====
Item       Authors                             Title   Year
=========  ==================================  ======  ====
[entry-1]  Jane Noakes, John Doe, Jane Roe     Book A  1999
[entry-2]  Jane Noakes, Richard Doe, Jane Roe  Book B  1999
=========  ==================================  ======  ====
   
In a style that has the form of the creator name set to ``short``,
``et-al-min`` set to ``3`` and ``et-al-use-first`` set to ``1``,
the lowest available transformation level for the first name of
both ``[entry-1]`` and ``[entry-2]`` will be the short form, "Doe".
If ``disambiguate-add-names`` is set to ``true``, and
``disambiguate-add-givenname`` is *not* set, names will be added
without names-based disambiguation. The value of
``et-al-use-first`` will be incrementally relaxed, until the names
for both cites has expanded to "Doe, Roe, Noakes".

To help dispell such lurking ambiguity without resorting to
names-based disambiguation, ``disambiguate-add-givenname`` can be
set to ``true`` and ``givenname-disambiguation-rule`` to
``by-cite``. This will cause the given names in cites that have
expanded to include all available names without exiting their cite
pool to be retried with one (and only one) increment to their
transformation level. Only increments that reduce the number of
ambiguous cites in the pool will be retained. If a cite is
successfully disambiguated by incrementing the name transformation
level in this phase, any trailing names not essential to
disambiguation will be dropped. In the case described above, the
processor would return the names "Noakes, J. Doe, et al." and
"Noakes, R. Doe, et al.", which is sufficient to disambiguate the
cites.

Once the adding of names and given names has been completed for a
cite pool, a final disambiguation phase may be invoked, if the
appropriate attributes are set and a cite pool still exists. If the
attribute ``disambiguate-year-suffix`` is set to ``true``, the
cites in the pool will each receive a letter or letters as a year
suffix. This option always results in a successful final
disambiguation of the cite.

If ``disambiguate-year-suffix`` is not used, a style may attempt to
disambiguate the ``position="subsequent"`` form of references by
testing for ``disambiguate="true"``. This boolean value will
evaluate true *only* for cites that are members of a cite pool in
this final phase of processing. In the example above, a style that
includes the title in the subsequent form of the cite only when
``disambiguate`` is ``true`` would be able to successfully
disambiguate the two references. When this type of disambiguation
fails, the added information is dropped from the cite.

Controlling Given Name Disambiguation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

As mentioned above, CSL 1.0 introduces a new
``givenname-disambiguation-rule`` attribute to select the algorithm
to be used during names-based disambiguation. With a value of
``by-cite``, no names-based disambiguation will be performed, and
any addition or expansion of given names in one citation will not
affect other occurences of that creator's name elsewhere in the
bibliography.

Four Given Name Disambiguation Rules
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Four values available on the ``givenname-disambiguation-rule``
attribute can be used to implement a large number of precisely
defined disambiguation schemes, greatly extending the scope of
disambiguation support. [1]_ The options are:

``all-names``
    Names-based disambiguation will be performed on all names that
    appear in the document. No ambiguous short names or initialized
    names will remain if this option is set, regardless of what the
    lowest available transformation level may be.
    If names begin at the lowest transformation level (short name), the
    transformation level of a name will be incremented to second level
    (initialized name), and then to the highest level (full name),
    stopping when the unique creator name has been unambiguously
    identified. This may result in a mixture of initialized names and
    full names within the bibiliography. (this is the default value)

``all-names-with-initials``
    Names-based disambiguation will be performed on all names that
    appear in the document, but no name will be raised above the second
    transformation level (initialized name). Names added with this
    option in force may be ambiguous, and therefore a resort to the
    final phase of disambiguation (``disambiguate-year-suffix`` or the
    ``disambiguate="true"`` conditional) is more likely to be needed to
    uniquely identify references.

``primary-name``
    This performs the same disambiguation operations as the
    ``all-names`` value, but names-based disambiguation is only
    performed on the first name in the list of creators used in a cite,
    and any increment in the name transformation level is applied only
    to first-listed names. Names appearing in the second and later
    positions in any cite will always use the lowest available name
    transformation level, without regard to disambiguation.

``primary-name-with-initials``
    Like the ``primary-name`` value, this performs the same operations
    as its ``all-names-with-initials`` corollary, but is limited to
    first-listed names only.


Short Name or Full Name Binary Selection
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

If a style requires short names, with full names to be used for
disambiguation (and never initialized names), this effect can be
achieved by the following:


-  On the ``citation`` node:
   
   -  Set ``disambiguate-add-givennames`` to ``true``; and
   -  Set ``givenname-disambiguation-rule`` to ``all-names`` or
      ``primary-name`` as appropriate;

-  On the ``name`` node:
   
   -  Set the form attribute to ``short``; and
   -  Do *not* set the ``initialize-with`` attribute.


If you get stuck, you should be able to get advice on the forums.

Advanced Sorting
----------------

CSL 1.0 features a number of extensions to support more complex
sorting rules. First, if the ``form`` attribute of ``cs:name`` is
now set to "count", the length of the name list will be returned.
For example, for an item with three authors (e.g. Jones, Smith and
Doe), a value of "3" would be obtained. This allows CSL styles to
sort according to the number of authors (or other types of
contributors). The second addition consists of two new attributes
for the ``cs:key`` element, ``names-min`` and ``names-use-first``.
The integer values set for these attributes override the values of
``et-al-min`` and ``et-al-min-first``, respectively. The following
example shows how these attributes can be used to sort a
bibliography alphabetically, taking only the first author into
account:

.. sourcecode:: xml

    <style>
      <macro name="author">
        <names variable="author">
          <name name-as-sort-order="all" />
        </names>
      </macro>
      <bibliography>
        <sort>
          <key macro="author" names-min="1" names-use-first="1"/>
        </sort>
        <layout>
        </layout>
      </bibliography>
    </style>

A more elaborate example can be found in the following unit test:

Related unit tests: \*
`sort\_AguStyle <http://bitbucket.org/fbennett/citeproc-js/src/tip/std/humans/sort_AguStyle.txt>`_

Back-References in Note Styles
------------------------------

XXXXX


-  near-note position and near-note-distance option
-  added first-reference-note-number variable (refers to the
   note-number of the note that is the first to mention the current
   reference)

Variables
---------

CSL 1.0 introduces a number of new variables:

 * number-of-pages (see `Pages`_)
 * page-first (see `Pages`_)
 * year-suffix (see `Year Suffix`_)

Terms
-----

CSL 1.0 introduces a number of new terms:

 * ``reference``. The ``references`` term from CSL 0.8 has been rename ``reference``.
 * ``editortranslator``. TODO: discuss in names-section
 * ordinals and long ordinals --> RZ: this should be discussed under formatting as well
 * added long-ordinal' value option of cs:number --> RZ: idem

Feedback
--------

Do you still miss a feature in CSL 1.0? Do you think the
documentation is incomplete, unclear or incorrect? We welcome
feedback on the ... --> do we want feedback on the Zotero forums
(Citation Styles forum category, http://forums.zotero.org/11/), or
on the xbiblio mailing list? Or will the new CSL website include a
dedicated forum for all things CSL?

Anything below this point is not meant for inclusion in the final version
-------------------------------------------------------------------------

Unfinished Business
~~~~~~~~~~~~~~~~~~~

-  clean up (i.e. remove) some of the comments/annotations in the
   schema
-  still have to describe some variables in spec (year-suffix,
   first-reference-note-number)

Errata
~~~~~~

-  no more group-by (maybe we won't have to mention this, as none
   of the current styles seem to use it)
-  is-date is no more (maybe we won't have to mention this, as none
   of the current styles seem to use it)

Post 1.0rc1 changesets (rc1 was tagged 08/15/09), until November 24th:

http://sourceforge.net/apps/trac/xbiblio/changeset/1157 Removing
class attribute from cs:group and start/end-attributes from
cs:names.

http://sourceforge.net/apps/trac/xbiblio/changeset/1163 Removed
orphaned cs:translator element

http://sourceforge.net/apps/trac/xbiblio/changeset/1168 Require
xml:lang on cs:locale in CSL styles.

http://sourceforge.net/apps/trac/xbiblio/changeset/1171 Removed
strip-periods from cs:term

http://sourceforge.net/apps/trac/xbiblio/changeset/1173 Add
particle-in-name-sort option attribute to bibliography element.
(this one has to go again probably)

http://sourceforge.net/apps/trac/xbiblio/changeset/1174 Removed
point-locator attribute from cs:text (use locator variable instead)
Removed form attribute from cs:text when used for macros.

http://sourceforge.net/apps/trac/xbiblio/changeset/1177 Removed
delimiter as an option from cs:layout when used in cs:bibliography
Clarified conditional behavior (as OR operator) Removed ability to
specify multiple variables in cs:date and cs:text. This means that
the delimiter on cs:date should now act to delimite the
date-parts.

http://sourceforge.net/apps/trac/xbiblio/changeset/1178 Removed the
delimiter as a possible attribute from cs:date when used to call
localized dates.

http://sourceforge.net/apps/trac/xbiblio/changeset/1183 Allow
(overriding) formatting attributes on cs:date-part when used
in-style in a call for a localized date.

http://sourceforge.net/apps/trac/xbiblio/changeset/1184 Removed
delimiter as a possible attribute of cs:text (part II of the
http://sourceforge.net/apps/trac/xbiblio/changeset/1177 patch)

http://sourceforge.net/apps/trac/xbiblio/changeset/1188 applying
info patch from Rintze, moving categor terms to separate file,
contributor roles to csl-variables.rnc

http://sourceforge.net/apps/trac/xbiblio/changeset/1189 removed
text-case attribute from 'formatting' pattern, added it to cs:text
(only)

http://sourceforge.net/apps/trac/xbiblio/changeset/1190 adding
text-case to label, number, date-part, name-part

http://sourceforge.net/apps/trac/xbiblio/changeset/1191 adding
csl-categories.rnc

http://sourceforge.net/apps/trac/xbiblio/changeset/1192 Changed
"true" value of second-field-align to "flush"

http://sourceforge.net/apps/trac/xbiblio/changeset/1201
Removed the "other" date-part.
(csl.rnc)

http://sourceforge.net/apps/trac/xbiblio/changeset/1207
adding 'linguistics'
(csl-categories.rnc)

http://sourceforge.net/apps/trac/xbiblio/changeset/1210
Changed name-particle-option to reflect current proposal.
(csl.rnc)

http://sourceforge.net/apps/trac/xbiblio/changeset/1212
Changed demote-particles option into a global option, renamed it to demote-non-dropping-particle.
(csl.rnc)

Locales files:

http://bitbucket.org/bdarcus/csl-locales/overview/
(all changes here should be reflected in the schema, so we should be able to skip this one)

Schema files:

http://bitbucket.org/bdarcus/csl-schema/overview/

http://bitbucket.org/bdarcus/csl-schema/changeset/528360192454/
adding 'jurisdiction', fixes #2
(csl-variables.rnc)

http://bitbucket.org/bdarcus/csl-schema/changeset/1d4f814940d3/
cleaned up pattern names on variable, moved dates to csl-variables.rnc file
(csl.rnc, csl-variables.rnc)

http://bitbucket.org/bdarcus/csl-schema/changeset/520dc1d2d993/
added global initialize-with-hyphen option, introduced hierarchical name and et-al options.
(csl.rnc)

http://bitbucket.org/bdarcus/csl-schema/changeset/836ed337fc1e/
adding csl data schema
(csl-data.rnc)

http://bitbucket.org/bdarcus/csl-schema/changeset/a14f0ded2c85/
minor tweaks, adding metadata
(csl-data.rnc)

http://bitbucket.org/bdarcus/csl-schema/changeset/52373cf45c98/
filling out rich-variable-pattern
(csl-data.rnc)

http://bitbucket.org/bdarcus/csl-schema/changeset/510b59327812/
making attribute optional
(csl-data.rnc)

http://bitbucket.org/bdarcus/csl-schema/changeset/f5b5f3c3a661/
Allow et-al-* attributes on cs:name
(csl.rnc)

http://bitbucket.org/bdarcus/csl-schema/changeset/bda1f0ab3f7e/
Correct regular expression pattern for ISSN(-L)s, which can have a roman "X" or "x" as check digit
(csl.rnc)

http://bitbucket.org/bdarcus/csl-schema/changeset/26c675c1c603/
Added required version attribute (with value "1.0") to cs:locale when occurring in standalone locale files 
(csl.rnc)

http://bitbucket.org/bdarcus/csl-schema/changeset/2aed27e6c033/
Renamed "references" to "reference", removed "reference item", added season-terms ("season-01", etc), added "ad"/"bc", put some existing terms in alphabetical order
(csl-terms.rnc)

Links - Revision histories of schema files
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A short history on the path from CSL 0.8 to 1.0: development of the
schema started with csl.rnc in trunk. The schema was split in the
split branch into csl.rnc, csl-core.rnc, csl-variables.rnc,
csl-types.rnc and csl-terms.rnc. csl-core.rnc was then folded into
csl-rnc. Once CSL 1.0RC1 was tagged, the split branch was merged
back to the trunk.

pre-split:
http://sourceforge.net/apps/trac/xbiblio/log/csl/schema/trunk/csl.rnc

split:
http://sourceforge.net/apps/trac/xbiblio/log/csl/schema/branches/split/csl-core.rnc?rev=1087
https://sourceforge.net/apps/trac/xbiblio/log/csl/schema/branches/split/csl.rnc?rev=1125
http://sourceforge.net/apps/trac/xbiblio/log/csl/schema/branches/split/csl-variables.rnc?rev=1125
http://sourceforge.net/apps/trac/xbiblio/log/csl/schema/branches/split/csl-types.rnc?rev=1125
http://sourceforge.net/apps/trac/xbiblio/log/csl/schema/branches/split/csl-terms.rnc?rev=1125

merge:
http://sourceforge.net/apps/trac/xbiblio/log/csl/schema/trunk/csl.rnc
http://sourceforge.net/apps/trac/xbiblio/log/csl/schema/trunk/csl-variables.rnc
http://sourceforge.net/apps/trac/xbiblio/log/csl/schema/trunk/csl-types.rnc
http://sourceforge.net/apps/trac/xbiblio/log/csl/schema/trunk/csl-terms.rnc
http://sourceforge.net/apps/trac/xbiblio/log/csl/schema/trunk/csl-categories.rnc

.. [1]
   A hat tip to user ```komrade`` <http://www.zotero.org/komrade>`_ of
   the Zotero forums, whose review of the major style guides led to
   this array of rule-sets.
